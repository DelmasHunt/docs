import { useSSG } from 'nextra/ssg';
import yaml from 'js-yaml';
import APIReference from '@components/APIReferences';
import { renderToString } from 'react-dom/server';

export const getStaticProps = async ({ params }) => {
  let openApiData = null;
  let stringElement = null;
  try {
    const response = await fetch(
      'https://raw.githubusercontent.com/livepeer/studio/master/packages/api/src/schema/api-schema.yaml',
    );
    const yamlContent = await response.text();
    openApiData = yaml.load(yamlContent);
    // Convert the Date object to a string representation
    if (
      openApiData.components?.schemas?.usage?.properties?.id?.example instanceof
      Date
    ) {
      openApiData.components.schemas.usage.properties.id.example =
        openApiData.components.schemas.usage.properties.id.example.toISOString();
    }
    const el = <APIReference openApiData={openApiData} />;
    stringElement = renderToString(el);
  } catch (error) {
    console.error('Error fetching OpenAPI YAML:', error);
  }
  return {
    props: {
      ssg: {
        stringElement,
      },
    },
    revalidate: 60,
  };
};

export const References = () => {
  // Get the data from SSG, and render it as a component.
  const { stringElement } = useSSG();
  return <div dangerouslySetInnerHTML={{ __html: stringElement }} />;
};

<References />
